# 内存池实现



虽然 java 支持垃圾自动回收，但是频繁的回收会造成很大的开销。为了减少开销，我们可以预先分配一段内存，然后优先从这里申请内存，如果不存在才会。这样



避免内存碎片，



kafka producer 缓存池，只针对特定大小的内存。

BufferPool 用于控制发送消息队列，占用的内存大小。

同时 BufferPool 也实现了针对特定大小的内存的缓存池。



BufferPool 的内存分为两部分，一个是缓存池，另一个是非缓存池。两者共享 BufferPool。



当申请内存的长度等于特定的数值，则从缓存池中获取。

如果不等于，则向非缓存池申请。如果非缓存池的大小不够，则尝试释放缓存池，因为两者共享资源，所以非缓存池的大小就会增大。



多个用户并发申请内存，是通过锁控制的。里面包含了一个等待的用户队列，队列采用了先进先出的方式。





















